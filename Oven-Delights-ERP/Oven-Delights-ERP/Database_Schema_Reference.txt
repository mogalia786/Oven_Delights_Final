DATABASE SCHEMA REFERENCE (2025-08-06)
========================================

This document is the authoritative developer reference for Oven Delights ERP. It lists EVERY table, field, type, PK, FK, constraint, and all stored procedures, triggers, and key relationships. Use this as the single source of truth for all code, queries, and future development. Do NOT use undocumented columns or tables.

---

Branches
--------
BranchID INT (PK, Identity)
BranchName NVARCHAR(100) NOT NULL
BranchCode NVARCHAR(20) NOT NULL, UNIQUE
Prefix NVARCHAR(10) NOT NULL -- for document numbering (PO, BOM, INV, Receipts)
Address NVARCHAR(255)
City NVARCHAR(100)
Province NVARCHAR(100)
PostalCode NVARCHAR(20)
Phone NVARCHAR(20)
Email NVARCHAR(100)
Manager NVARCHAR(100)
IsActive BIT DEFAULT 1
CreatedDate DATETIME DEFAULT GETDATE()
CreatedBy INT
ModifiedDate DATETIME
ModifiedBy INT
CostCenterCode NVARCHAR(20)

Roles
-----
RoleID INT (PK, Identity)
RoleName NVARCHAR(50) NOT NULL, UNIQUE
Description NVARCHAR(255)
IsActive BIT DEFAULT 1
CreatedDate DATETIME DEFAULT GETDATE()
CreatedBy INT
ModifiedDate DATETIME
ModifiedBy INT

(Role list: Super-Administrator, Stockroom_Manager, Manufacturing_Manager, Admin, Retail-Manager)

Users
-----
UserID INT (PK, Identity)
Username NVARCHAR(50) NOT NULL, UNIQUE
Email NVARCHAR(128) NOT NULL, UNIQUE
Password NVARCHAR(255)
FirstName NVARCHAR(50)
LastName NVARCHAR(50)
Phone NVARCHAR(20)
ProfilePicture NVARCHAR(255)
RoleID INT NOT NULL (FK to Roles)
BranchID INT (FK to Branches)
IsActive BIT DEFAULT 1
CreatedDate DATETIME DEFAULT GETDATE()
CreatedBy INT
ModifiedDate DATETIME
ModifiedBy INT
LastLoginDate DATETIME
FailedLoginAttempts INT DEFAULT 0
IsLocked BIT DEFAULT 0
LockoutEndDate DATETIME
PasswordLastChanged DATETIME DEFAULT GETDATE()
TwoFactorEnabled BIT DEFAULT 0
TwoFactorSecret NVARCHAR(255)
EmailVerified BIT DEFAULT 0
PhoneVerified BIT DEFAULT 0

UserSessions
------------
SessionID INT (PK, Identity)
UserID INT NOT NULL (FK to Users)
SessionToken NVARCHAR(255) UNIQUE NOT NULL
LoginTime DATETIME DEFAULT GETDATE()
LogoutTime DATETIME
LastActivity DATETIME DEFAULT GETDATE()
IPAddress NVARCHAR(45)
UserAgent NVARCHAR(500)
IsActive BIT DEFAULT 1
DeviceInfo NVARCHAR(255)

AuditLog
--------
AuditID INT (PK, Identity)
UserID INT (FK to Users)
Action NVARCHAR(50) NOT NULL
TableName NVARCHAR(50)
RecordID INT
OldValues NVARCHAR(MAX)
NewValues NVARCHAR(MAX)
Timestamp DATETIME DEFAULT GETDATE()
IPAddress NVARCHAR(45)
UserAgent NVARCHAR(500)
DeviceInfo NVARCHAR(255)

Permissions
-----------
PermissionID INT (PK, Identity)
PermissionName NVARCHAR(100) NOT NULL, UNIQUE
Description NVARCHAR(255)
Module NVARCHAR(50)
IsActive BIT DEFAULT 1

RolePermissions
---------------
RolePermissionID INT (PK, Identity)
RoleID INT NOT NULL (FK to Roles)
PermissionID INT NOT NULL (FK to Permissions)
CanCreate BIT DEFAULT 0
CanRead BIT DEFAULT 0
CanUpdate BIT DEFAULT 0
CanDelete BIT DEFAULT 0
UNIQUE(RoleID, PermissionID)

UserPreferences
---------------
PreferenceID INT (PK, Identity)
UserID INT NOT NULL (FK to Users)
PreferenceName NVARCHAR(100) NOT NULL
PreferenceValue NVARCHAR(500)
UNIQUE(UserID, PreferenceName)

PasswordHistory
---------------
HistoryID INT (PK, Identity)
UserID INT NOT NULL (FK to Users)
PasswordHash NVARCHAR(255) NOT NULL
CreatedDate DATETIME DEFAULT GETDATE()

Notifications
-------------
NotificationID INT (PK, Identity)
Title NVARCHAR(100) NOT NULL
Message NVARCHAR(500) NOT NULL
NotificationType NVARCHAR(50) DEFAULT 'INFO'
CreatedDate DATETIME DEFAULT GETDATE()
CreatedBy INT (FK to Users)
IsActive BIT DEFAULT 1

UserNotifications
-----------------
UserNotificationID INT (PK, Identity)
UserID INT NOT NULL (FK to Users)
NotificationID INT NOT NULL (FK to Notifications)
IsRead BIT DEFAULT 0
ReadDate DATETIME

SystemSettings
--------------
SettingID INT (PK, Identity)
SettingName NVARCHAR(100) NOT NULL, UNIQUE
SettingValue NVARCHAR(500)
Description NVARCHAR(255)
Category NVARCHAR(50)
ModifiedDate DATETIME DEFAULT GETDATE()
ModifiedBy INT (FK to Users)

AccountingJournals
------------------
JournalID INT (PK, Identity)
JournalType NVARCHAR(50) NOT NULL
ReferenceID INT NOT NULL
ReferenceTable NVARCHAR(50) NOT NULL
DebitAccount NVARCHAR(20)
CreditAccount NVARCHAR(20)
Amount DECIMAL(18,2) DEFAULT 0
Description NVARCHAR(255)
TransactionDate DATETIME DEFAULT GETDATE()
CreatedBy INT (FK to Users)

InventoryTransactions
---------------------
TransactionID INT (PK, Identity)
BranchID INT (FK to Branches)
InventoryItemID INT
TransactionType NVARCHAR(50)
Quantity DECIMAL(18,2)
TransactionDate DATETIME DEFAULT GETDATE()
Reference NVARCHAR(50)
CreatedBy INT (FK to Users)

PurchaseOrderItems
------------------
PurchaseOrderItemID INT (PK, Identity)
PurchaseOrderID INT (FK to PurchaseOrders)
ItemID INT
Quantity DECIMAL(18,2)
UnitPrice DECIMAL(18,2)
TotalPrice AS (Quantity * UnitPrice)
ReceivedQuantity DECIMAL(18,2) DEFAULT 0
Status NVARCHAR(50)

PurchaseOrders
--------------
PurchaseOrderID INT (PK, Identity)
OrderNumber NVARCHAR(50) NOT NULL, UNIQUE
BranchID INT (FK to Branches)
SupplierID INT (FK to Suppliers)
OrderDate DATETIME DEFAULT GETDATE()
Status NVARCHAR(50)
CreatedBy INT (FK to Users)
ApprovedBy INT (FK to Users)
TotalAmount DECIMAL(18,2)
Prefix NVARCHAR(10) -- for document numbering

RawMaterials
------------
RawMaterialID INT (PK, Identity)
MaterialName NVARCHAR(100) NOT NULL
Description NVARCHAR(255)
Unit NVARCHAR(20)
IsActive BIT DEFAULT 1
CreatedDate DATETIME DEFAULT GETDATE()
CreatedBy INT (FK to Users)

Suppliers
---------
SupplierID INT (PK, Identity)
SupplierName NVARCHAR(100) NOT NULL
ContactName NVARCHAR(100)
ContactEmail NVARCHAR(100)
ContactPhone NVARCHAR(20)
Address NVARCHAR(255)
City NVARCHAR(100)
Province NVARCHAR(100)
PostalCode NVARCHAR(20)
IsActive BIT DEFAULT 1
CreatedDate DATETIME DEFAULT GETDATE()
CreatedBy INT (FK to Users)

UserPermissions
---------------
UserPermissionID INT (PK, Identity)
UserID INT (FK to Users)
PermissionID INT (FK to Permissions)
CanCreate BIT DEFAULT 0
CanRead BIT DEFAULT 0
CanUpdate BIT DEFAULT 0
CanDelete BIT DEFAULT 0

--

STORED PROCEDURES & KEY LOGIC
=============================

sp_CreateJournalEntry(@JournalDate, @Reference, @Description, @FiscalPeriodID, @CreatedBy, @BranchID, @JournalID OUT)
- Creates a new journal entry and returns JournalID.

sp_AddJournalDetail(@JournalID, @AccountID, @Debit, @Credit, ...)
- Adds a journal detail line to a journal.

sp_PostJournal(@JournalID, @PostedBy)
- Posts a journal (updates status, balances, etc).

sp_GenerateTrialBalance(@AsOfDate, @BranchID, @IncludeZeroBalances)
- Generates a trial balance report.

--

All other business logic, triggers, and procedures must reference ONLY these columns and tables. Any new features/modules must be added here before being used in code.

If you need a breakdown for a specific table, procedure, or want to add a new module, update this document FIRST.